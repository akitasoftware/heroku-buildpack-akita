#!/usr/bin/env bash
# bin/compile BUILD_DIR CACHE_DIR ENV_DIR

set -euo pipefail
set -x

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

BUILDPACK_DIR=$(cd "$(dirname "${BUILD_DIR}")"; cd ..; pwd)

# TODO(kku): store apt cache in CACHE_DIR

echo "Installing Akita CLI"

wget \
  -O akita_0.10.4_linux_amd64.zip \
  https://releases.akita.software/cli/0.10.4/akita_0.10.4_linux_amd64.zip

unzip akita_0.10.4_linux_amd64.zip
mkdir -p ${HOME}/akita/bin
mv akita ${HOME}/akita/bin/akita

# Add to .profile.d to automatically run at startup.
echo "Setting up Akita CLI in .profile.d"

mkdir -p "${BUILD_DIR}/.profile.d"
cp "${BUILDPACK_DIR}/.profile.d/akita.sh" "${BUILD_DIR}/.profile.d/akita.sh"
chmod +x "${BUILD_DIR}/.profile.d/akita.sh"
